# ep.exe expects exactly 5 parameters: 
# 1. packet in hex string
# 2. Is packet IPv4 (1 or 0)
# 3. dscp (99 if packet is not IPv4)
# 4. optionsPresent (true if packet is not IPv4)
# 5. protocol (99 if packet is not IPv4)


add_test(
	NAME TestSuccess 
	COMMAND ${CMAKE_BINARY_DIR}/ep.exe 145afc168c4f1027f51c3eea0800450000286d2f400039062f22d1c50308c0a810090050f30a635f2af360d81808501100930f3400000000b2e01954 1 0 0 4
)
add_test(
	NAME TestFail
	COMMAND ${CMAKE_BINARY_DIR}/ep.exe 954 1 0 0 4
)
set_tests_properties(TestFail PROPERTIES WILL_FAIL TRUE)

add_test(
	NAME TestHexStringNotDivisibleBy2
	COMMAND ${CMAKE_BINARY_DIR}/ep.exe 954 1 0 0 4
)
set_tests_properties(
		TestHexStringNotDivisibleBy2 
	PROPERTIES
		PASS_REGULAR_EXPRESSION "must be divisible by 2"
)

string(RANDOM LENGTH 18002 RND_STR)
add_test(
	NAME TestHexStringTooLong
	COMMAND ${CMAKE_BINARY_DIR}/ep.exe ${RND_STR} 1 0 0 4
)
set_tests_properties(
		TestHexStringTooLong 
	PROPERTIES
		PASS_REGULAR_EXPRESSION "Buffer too small, string is"
)
string(RANDOM LENGTH 18000 RND_STR)
add_test(
	NAME TestHexStringExactLen
	COMMAND ${CMAKE_BINARY_DIR}/ep.exe ${RND_STR} 1 0 0 4
)
set_tests_properties(
		TestHexStringExactLen
	PROPERTIES
		FAIL_REGULAR_EXPRESSION "Buffer too small, string is"
		PASS_REGULAR_EXPRESSION "Invalid hexadecimal"
)

add_test(
	NAME TestHexStringInvalidHex
	COMMAND ${CMAKE_BINARY_DIR}/ep.exe 145afc168c4f1027f51c3eea0800450000286d2f400039062f22d1c50308c0a810090050f3Xa635f2af360d81808501100930f3400000000b2e01954 1 0 0 4
)
set_tests_properties(
		TestHexStringInvalidHex 
	PROPERTIES
		PASS_REGULAR_EXPRESSION "Invalid hexadecimal"
)

add_test(
	NAME NotIPv4
	COMMAND ${CMAKE_BINARY_DIR}/ep.exe 145afc168c4f1027f51c3eea0801550000286d2f400039062f22d1c50308c0a810090050f30a635f2af360d81808501100930f3400000000b2e01954 0 99 1 99
)
add_test(
	NAME VLANOne
	COMMAND ${CMAKE_BINARY_DIR}/ep.exe 145afc168c4f1027f51c3eea8100FFFF0800450000286d2f400039062f22d1c50308c0a810090050f30a635f2af360d81808501100930f3400000000b2e01954 1 0 0 4
)
add_test(
	NAME VLANTwo
	COMMAND ${CMAKE_BINARY_DIR}/ep.exe 145afc168c4f1027f51c3eea88A8FFFF8100FFFF0800450000286d2f400039062f22d1c50308c0a810090050f30a635f2af360d81808501100930f3400000000b2e01954 1 0 0 4
)
add_test(
	NAME VLANThree
	COMMAND ${CMAKE_BINARY_DIR}/ep.exe 145afc168c4f1027f51c3eea88A8FFFF88A8FFFF8100FFFF0800450000286d2f400039062f22d1c50308c0a810090050f30a635f2af360d81808501100930f3400000000b2e01954 1 0 0 4
)
add_test(
	NAME OptionsPresent 
	COMMAND ${CMAKE_BINARY_DIR}/ep.exe 145afc168c4f1027f51c3eea08004A0000286d2f400039062f22d1c50308c0a810090050f30a635f2af360d81808501100930f3400000000b2e01954 1 0 1 4
)
add_test(
	NAME DscpOver0 
	COMMAND ${CMAKE_BINARY_DIR}/ep.exe 145afc168c4f1027f51c3eea08004AFF00286d2f400039062f22d1c50308c0a810090050f30a635f2af360d81808501100930f3400000000b2e01954 1 63 1 4
)